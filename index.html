<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go (Golang) Comprehensive Master Guide</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate 50 */
        }
        /* Custom styles for rendered code blocks (created by marked.js) */
        #markdown-container pre code {
            display: block;
            background-color: #1e293b; /* Slate 800 */
            color: #f8fafc; /* Slate 50 */
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-x: auto;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        /* Style for tables generated by marked.js */
        #markdown-container table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border-radius: 0.5rem;
            overflow: hidden;
            background-color: white;
        }
        #markdown-container th, #markdown-container td {
            border: 1px solid #e2e8f0; /* Slate 200 */
            padding: 0.75rem 1rem;
            text-align: left;
        }
        #markdown-container thead th {
            background-color: #f1f5f9; /* Slate 100 */
            font-weight: 600;
            color: #475569; /* Slate 600 */
        }

        /* TOC Styles */
        .toc-link {
            cursor: pointer;
        }
        .toc-link:hover {
            color: #0d9488; /* Teal 600 */
        }
        .active-link {
            font-weight: 600;
            color: #0f766e; /* Teal 700 */
            border-left: 3px solid #0f766e;
        }
        /* Markdown heading styles */
        #markdown-container h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #0f172a;
        }
        #markdown-container h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #1e293b;
        }
        #markdown-container h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            color: #334155;
        }
        #markdown-container strong {
            font-weight: 700;
            color: #1e293b;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Main Grid Container -->
    <div class="flex flex-col lg:flex-row min-h-screen">

        <!-- Left Column: Table of Contents (Fixed) -->
        <nav id="toc" class="lg:w-max bg-white border-b lg:border-r lg:border-b-0 shadow-lg lg:shadow-xl p-6 lg:sticky lg:top-0 lg:h-screen overflow-y-auto z-10">
            <h1 class="text-3xl font-extrabold text-teal-700 mb-6 hidden lg:block">Go Master Guide</h1>
            <h2 class="text-xl font-bold text-teal-700 block lg:hidden">Go Guide TOC</h2>
            
            <!-- TOC Links will be inserted here by JavaScript -->
            <ul id="toc-list" class="space-y-3 mt-4 hidden lg:block">
                <li class="text-sm text-slate-500">Loading content...</li>
            </ul>
        </nav>

        <!-- Right Column: Scrollable Content -->
        <main class="flex-grow p-6 md:p-10 lg:p-16 bg-slate-50">
            <article id="content-area" class="prose max-w-none">
                
    
                
                <!-- Markdown content will be rendered into this container -->
                <div id="markdown-container">
                    <p class="text-center text-lg text-slate-500">Loading guide content...</p>
                </div>

                <footer class="text-center pt-8 border-t border-slate-300">
                    <p class="text-sm text-slate-500">&copy; 2024 Go Master Guide. Built with a passion for simplicity.</p>
                </footer>

            </article>
        </main>
    </div>

    <script>
        // Path to the file containing the list of all Markdown files to load, in order.
        const manifestPath = 'DOC_FILES.txt'; 
        
        const contentContainer = document.getElementById('markdown-container');
        const tocList = document.getElementById('toc-list');
        const mainContentArea = document.getElementById('content-area');
        
        let allPages = []; // Store all loaded pages
        let currentPageIndex = 0; // Track current page

        /**
         * Loads the file list from DOC_FILES.txt, then fetches and renders all Markdown content.
         */
        async function loadAndRenderContent() {
            let markdownFiles = [];

            try {
                // 1. Fetch file list from DOC_FILES.txt
                contentContainer.innerHTML = `<p class="text-center text-lg text-slate-500 animate-pulse">Fetching file list from ${manifestPath}...</p>`;
                console.log(`[INFO] 1. Starting documentation load. Manifest path: ${manifestPath}`);

                const fileListResponse = await fetch(manifestPath);
                if (!fileListResponse.ok) {
                    throw new Error(`Failed to load file list from ${manifestPath}. Status: ${fileListResponse.status}. Please ensure this file exists.`);
                }
                const fileListText = await fileListResponse.text();
                
                // Parse file names (one per line, filtering out empty lines and trimming whitespace)
                markdownFiles = fileListText.split('\n').map(s => s.trim()).filter(s => s.length > 0);
                
                if (markdownFiles.length === 0) {
                    throw new Error(`The file ${manifestPath} is empty or contains no valid file names.`);
                }

                console.log(`[INFO] 2. Manifest loaded successfully. Found ${markdownFiles.length} files:`, markdownFiles);

                contentContainer.innerHTML = `<p class="text-center text-lg text-slate-500 animate-pulse">Fetching ${markdownFiles.length} documentation files...</p>`;

                // 2. Create an array of fetch promises for the Markdown files
                const fetchPromises = markdownFiles.map((file, index) => {
                    const encodedFile = encodeURIComponent(file);
                    console.log(`[INFO] 3. Requesting file: ${encodedFile} (Original: ${file})`);

                    return fetch(encodedFile).then(response => {
                        if (!response.ok) {
                            console.error(`[ERROR] Failed to load individual file: ${file}. Status: ${response.status}`);
                            throw new Error(`Failed to load file: ${file} (Status: ${response.status})`);
                        }
                        return response.text().then(content => ({
                            filename: file,
                            content: content,
                            index: index
                        }));
                    });
                });

                // 3. Wait for all files to load
                const fileData = await Promise.all(fetchPromises);
                
                // Helper to clean potential Byte Order Mark (BOM)
                const cleanContent = (content) => content.replace(/^\ufeff/, '');

                // 4. Store all pages separately
                allPages = fileData.map(file => ({
                    filename: file.filename,
                    content: cleanContent(file.content),
                    index: file.index
                }));
                
                console.log("[INFO] 4. All files loaded. Starting Markdown parsing.");

                // 5. Set up marked options
                marked.use({
                    gfm: true,
                    headerIds: true,
                });

                // 6. Build TOC from all pages
                buildTableOfContents();
                
                // 7. Display first page
                showPage(0);
                console.log("[INFO] 5. Rendering complete. TOC built.");

            } catch (error) {
                console.error("[FATAL ERROR] Error loading or rendering Markdown:", error);
                
                // FIX: Using a single Template Literal (backticks) for robust, multi-line HTML assignment
                contentContainer.innerHTML = `
                    <p class="text-red-600 font-bold">Error: Could not load the documentation.</p>
                    <p>The system failed to load content. Check the console for details, specifically errors related to:
                        <ul>
                            <li><code>${manifestPath}</code> not found
                            <li>One of the ${markdownFiles.length} files listed in the manifest is missing or has a path mismatch.</li>
                        </ul>
                    </p>
                    <pre class="bg-red-50 p-4 rounded-lg text-sm text-red-800 mt-4">${error.message}</pre>
                `;
                
                tocList.innerHTML = `<li class="text-sm text-red-500">Error loading guide.</li>`;
            }
        }



        /**
         * Display a specific page by index
         */
        function showPage(pageIndex) {
            if (pageIndex < 0 || pageIndex >= allPages.length) return;
            
            currentPageIndex = pageIndex;
            const page = allPages[pageIndex];
            
            // Render the markdown for this page
            const htmlContent = marked.parse(page.content);
            contentContainer.innerHTML = htmlContent;
            
            // Update active state in TOC
            updateActiveTOCLink(pageIndex);
            
            // Scroll to top of content
            mainContentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        /**
         * Update which TOC link is active
         */
        function updateActiveTOCLink(pageIndex) {
            const tocLinks = document.querySelectorAll('#toc-list .toc-link');
            tocLinks.forEach((link, index) => {
                if (index === pageIndex) {
                    link.classList.add('active-link');
                } else {
                    link.classList.remove('active-link');
                }
            });
        }

        /**
         * Builds the Table of Contents from all page filenames
         */
        function buildTableOfContents() {
            tocList.innerHTML = '';
            
            allPages.forEach((page, index) => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.className = 'font-bold toc-link block pl-2 border-l-2 border-transparent text-sm hover:text-teal-600 cursor-pointer';
                
                // Extract title from filename (remove numbers and .md extension)
                let title = page.filename.replace(/\.md$/, '');

                const hasSubTopicNumber = /^\d+\.\d+/.test(page.filename);
                if (hasSubTopicNumber) {
                    title = "- " + page.filename;
                }
            
                a.textContent = title;
                
                // Add click handler to navigate to this page
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage(index);
                });
                
                li.appendChild(a);
                tocList.appendChild(li);
            });

            tocList.classList.remove('hidden');
        }


        // Start the loading process when the page is fully loaded
        document.addEventListener('DOMContentLoaded', loadAndRenderContent);
    </script>
</body>
</html>
